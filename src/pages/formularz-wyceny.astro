---
import Header from "../components/Header.astro";
import Sidebar from "../components/Sidebar.astro";
---
<!DOCTYPE html>
<html lang="pl">
  <Header 
    title="Formularz wyceny | 41.pl" 
    description="Wyslij zapytanie o wycene projektu. Administracja serwerow, tworzenie stron, programowanie. Odpowiadamy w ciagu 24 godzin."
  />
  <body>
    <div class="content">
      <Sidebar selectedItem="" />
      <nav class="main">
        <div class="container">
          <div class="back-nav-container">
            <a href="/" class="back-nav-button w-inline-block">
              <img src="/assets/back.svg" loading="lazy" alt="" class="back-nav-img" />
              <div>Powrot</div>
            </a>
          </div>
          <div class="content-container">
            <h1>Formularz wyceny</h1>
            
            <p class="lead">
              Opisz swoj projekt lub potrzeby. Odpowiadamy w ciagu 24 godzin.
            </p>
            
            <div id="form-container">
              <form id="wycena-form" class="form-wycena">
                <div class="form-group">
                  <label for="nazwa" class="form-label">Imie lub nazwa firmy</label>
                  <input type="text" id="nazwa" name="nazwa" required class="form-input" placeholder="Jan Kowalski" />
                </div>
                
                <div class="form-group">
                  <label for="email" class="form-label">Adres email</label>
                  <input type="email" id="email" name="email" required class="form-input" placeholder="jan@example.pl" />
                </div>
                
                <div class="form-group">
                  <label for="opis" class="form-label">Opis projektu</label>
                  <textarea id="opis" name="opis" required class="form-textarea" rows="6" placeholder="Opisz czego potrzebujesz..."></textarea>
                </div>
                
                <button type="submit" id="submit-btn" class="button form-button">Wyslij zapytanie</button>
              </form>
            </div>
            
            <div id="form-success" class="form-message form-success" style="display: none;">
              <h3>Dziekujemy!</h3>
              <p class="lead">Twoje zgloszenie zostalo wyslane. Odpowiemy w ciagu 24 godzin.</p>
              <p class="lead">Potwierdzenie zostalo wyslane na podany adres email.</p>
            </div>
            
            <div id="form-error" class="form-message form-error" style="display: none;">
              <h3>Wystapil blad</h3>
              <p class="lead" id="error-message">Sprobuj ponownie pozniej.</p>
              <button onclick="location.reload()" class="button form-button">Sprobuj ponownie</button>
            </div>
            
          </div>
        </div>
      </nav>
    </div>
    
    <style>
      .form-wycena {
        display: flex;
        flex-direction: column;
        gap: 24px;
        max-width: 500px;
      }
      
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .form-label {
        color: #fff;
        font-size: 14px;
        font-family: 'IBM Plex Mono', monospace;
        text-transform: uppercase;
        letter-spacing: 0.75px;
      }
      
      .form-input,
      .form-textarea {
        background-color: #1c1c1c;
        border: 1px solid #353535;
        border-radius: 8px;
        padding: 14px 16px;
        color: #fff;
        font-family: inherit;
        font-size: 16px;
        line-height: 24px;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      
      .form-input:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #555;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
      }
      
      .form-input::placeholder,
      .form-textarea::placeholder {
        color: #666;
      }
      
      .form-textarea {
        resize: vertical;
        min-height: 120px;
      }
      
      .form-button {
        align-self: flex-start;
        margin-top: 8px;
        cursor: pointer;
      }
      
      .form-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .form-message {
        max-width: 500px;
        padding: 32px;
        border-radius: 12px;
      }
      
      .form-success {
        background-color: rgba(0, 200, 100, 0.1);
        border: 1px solid rgba(0, 200, 100, 0.3);
      }
      
      .form-error {
        background-color: rgba(255, 100, 100, 0.1);
        border: 1px solid rgba(255, 100, 100, 0.3);
      }
      
      .form-message h3 {
        margin-bottom: 16px;
      }
      
      .form-message .lead {
        margin-bottom: 12px;
      }
      
      @media screen and (max-width: 767px) {
        .form-wycena {
          max-width: 100%;
        }
        
        .form-message {
          max-width: 100%;
          padding: 24px;
        }
        
        .form-button {
          width: 100%;
          text-align: center;
        }
      }
    </style>
    
    <script>
      document.getElementById('wycena-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const btn = document.getElementById('submit-btn');
        const formContainer = document.getElementById('form-container');
        const successMsg = document.getElementById('form-success');
        const errorMsg = document.getElementById('form-error');
        const errorText = document.getElementById('error-message');
        
        btn.disabled = true;
        btn.textContent = 'Wysylanie...';
        
        const data = {
          nazwa: document.getElementById('nazwa').value,
          email: document.getElementById('email').value,
          opis: document.getElementById('opis').value
        };
        
        try {
          const response = await fetch('https://api.41.pl/wycena.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-API-Key': '41pl_a7Kx9mP2qL5vN8wR'
            },
            body: JSON.stringify(data)
          });
          
          const result = await response.json();
          
          if (result.success) {
            formContainer.style.display = 'none';
            successMsg.style.display = 'block';
          } else {
            formContainer.style.display = 'none';
            errorText.textContent = result.error || 'Wystapil nieoczekiwany blad.';
            errorMsg.style.display = 'block';
          }
        } catch (err) {
          formContainer.style.display = 'none';
          errorText.textContent = 'Blad polaczenia. Sprawdz internet i sprobuj ponownie.';
          errorMsg.style.display = 'block';
        }
      });
    </script>
  </body>
</html>
